<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Diff Calculator - Tools</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.4;
            color: #333;
            max-width: 1100px;
            margin: 0 auto;
            padding: 0.75rem 1rem;
        }
        h1 {
            font-size: 1.5rem;
            margin-bottom: 0.375rem;
        }
        h2 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: #24292f;
        }
        p { color: #555; }
        a { color: #0969da; text-decoration: none; }
        a:hover { text-decoration: underline; }

        .section {
            margin-top: 1rem;
            border-top: 1px solid #e1e4e8;
            padding-top: 0.75rem;
        }

        .calc-box {
            background: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 10px;
            padding: 1rem 1.25rem;
            margin-top: 0.75rem;
        }

        .input-group {
            margin-bottom: 0.75rem;
        }
        .input-group label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: #656d76;
            margin-bottom: 0.25rem;
        }
        .input-row {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }
        .input-row input {
            padding: 0.5rem 0.75rem;
            font-size: 1rem;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            font-variant-numeric: tabular-nums;
            outline: none;
        }
        .input-row input:focus {
            border-color: #0969da;
            box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.15);
        }
        .input-row input[type="date"] {
            width: 160px;
        }
        .input-row input[type="number"] {
            width: 70px;
            text-align: center;
        }
        .input-row .sep {
            font-size: 1.1rem;
            font-weight: 600;
            color: #656d76;
        }
        .input-row button {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            background: #0969da;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            white-space: nowrap;
        }
        .input-row button:hover {
            background: #0860ca;
        }

        .result-box {
            margin-top: 0.75rem;
            display: none;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
        }
        .result-table th,
        .result-table td {
            text-align: left;
            padding: 0.4rem 0.5rem;
            border-bottom: 1px solid #e1e4e8;
            font-size: 0.9rem;
        }
        .result-table th {
            color: #656d76;
            font-weight: 600;
            width: 35%;
        }
        .result-table td {
            font-variant-numeric: tabular-nums;
        }

        .error-msg {
            color: #cf222e;
            font-size: 0.85rem;
            margin-top: 0.25rem;
            display: none;
        }

        @media (max-width: 480px) {
            .input-row {
                flex-direction: column;
                align-items: stretch;
            }
            .input-row input[type="date"],
            .input-row input[type="number"] {
                width: 100%;
            }
            .time-inputs {
                display: flex;
                gap: 0.5rem;
                align-items: center;
            }
            .time-inputs input {
                flex: 1;
                min-width: 0;
            }
        }
    </style>
</head>
<body>
    <p><a href="index.html">&larr; Back to Tools</a></p>
    <h1>Time Diff Calculator</h1>
    <p>Calculate the time difference between two dates/times.</p>

    <!-- Section 1: Diff from now -->
    <div class="section">
        <h2>Difference from Now</h2>
        <div class="calc-box">
            <div class="input-group">
                <label>Date & Time</label>
                <div class="input-row">
                    <input type="date" id="s1-date">
                    <span class="time-inputs">
                        <input type="number" id="s1-hour" min="0" max="23" placeholder="HH" value="0">
                        <span class="sep">:</span>
                        <input type="number" id="s1-min" min="0" max="59" placeholder="MM" value="0">
                        <span class="sep">:</span>
                        <input type="number" id="s1-sec" min="0" max="59" placeholder="SS" value="0">
                    </span>
                    <button id="s1-btn">Calculate</button>
                </div>
            </div>
            <div class="error-msg" id="s1-error"></div>
            <div class="result-box" id="s1-result">
                <table class="result-table">
                    <tr><th>Input Time</th><td id="s1-input-display"></td></tr>
                    <tr><th>Current Time</th><td id="s1-now-display"></td></tr>
                    <tr><th>Days / Hours / Minutes / Seconds</th><td id="s1-dhms"></td></tr>
                    <tr><th>Total Hours</th><td id="s1-hours"></td></tr>
                </table>
            </div>
        </div>
    </div>

    <!-- Section 2: Diff between two times -->
    <div class="section">
        <h2>Difference Between Two Times</h2>
        <div class="calc-box">
            <div class="input-group">
                <label>Start Time</label>
                <div class="input-row">
                    <input type="date" id="s2-date1">
                    <span class="time-inputs">
                        <input type="number" id="s2-hour1" min="0" max="23" placeholder="HH" value="0">
                        <span class="sep">:</span>
                        <input type="number" id="s2-min1" min="0" max="59" placeholder="MM" value="0">
                        <span class="sep">:</span>
                        <input type="number" id="s2-sec1" min="0" max="59" placeholder="SS" value="0">
                    </span>
                </div>
            </div>
            <div class="input-group">
                <label>End Time</label>
                <div class="input-row">
                    <input type="date" id="s2-date2">
                    <span class="time-inputs">
                        <input type="number" id="s2-hour2" min="0" max="23" placeholder="HH" value="0">
                        <span class="sep">:</span>
                        <input type="number" id="s2-min2" min="0" max="59" placeholder="MM" value="0">
                        <span class="sep">:</span>
                        <input type="number" id="s2-sec2" min="0" max="59" placeholder="SS" value="0">
                    </span>
                    <button id="s2-btn">Calculate</button>
                </div>
            </div>
            <div class="error-msg" id="s2-error"></div>
            <div class="result-box" id="s2-result">
                <table class="result-table">
                    <tr><th>Start Time</th><td id="s2-start-display"></td></tr>
                    <tr><th>End Time</th><td id="s2-end-display"></td></tr>
                    <tr><th>Days / Hours / Minutes / Seconds</th><td id="s2-dhms"></td></tr>
                    <tr><th>Total Hours</th><td id="s2-hours"></td></tr>
                </table>
            </div>
        </div>
    </div>

    <script>
        function clamp(val, min, max) {
            const n = parseInt(val, 10);
            if (isNaN(n)) return min;
            return Math.max(min, Math.min(max, n));
        }

        function formatDateTime(d) {
            return d.getFullYear() + '-' +
                String(d.getMonth() + 1).padStart(2, '0') + '-' +
                String(d.getDate()).padStart(2, '0') + ' ' +
                String(d.getHours()).padStart(2, '0') + ':' +
                String(d.getMinutes()).padStart(2, '0') + ':' +
                String(d.getSeconds()).padStart(2, '0');
        }

        function formatDiff(ms) {
            const totalSeconds = Math.floor(Math.abs(ms) / 1000);
            const days = Math.floor(totalSeconds / 86400);
            const hours = Math.floor((totalSeconds % 86400) / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            const totalHours = (Math.abs(ms) / 3600000).toFixed(2);

            let dhms = '';
            if (days > 0) dhms += days + ' day' + (days !== 1 ? 's' : '') + ' ';
            if (days > 0 || hours > 0) dhms += hours + ' hour' + (hours !== 1 ? 's' : '') + ' ';
            if (days > 0 || hours > 0 || minutes > 0) dhms += minutes + ' minute' + (minutes !== 1 ? 's' : '') + ' ';
            dhms += seconds + ' second' + (seconds !== 1 ? 's' : '');

            return { dhms: dhms, totalHours: totalHours };
        }

        function buildDate(dateStr, hourEl, minEl, secEl) {
            if (!dateStr) return null;
            const h = clamp(hourEl.value, 0, 23);
            const m = clamp(minEl.value, 0, 59);
            const s = clamp(secEl.value, 0, 59);
            hourEl.value = h;
            minEl.value = m;
            secEl.value = s;
            const parts = dateStr.split('-');
            return new Date(
                parseInt(parts[0], 10),
                parseInt(parts[1], 10) - 1,
                parseInt(parts[2], 10),
                h, m, s
            );
        }

        function showError(el, msg) {
            el.textContent = msg;
            el.style.display = 'block';
        }
        function hideError(el) {
            el.style.display = 'none';
        }

        // Section 1: Difference from now
        document.getElementById('s1-btn').addEventListener('click', function () {
            const errorEl = document.getElementById('s1-error');
            const resultEl = document.getElementById('s1-result');
            const dateVal = document.getElementById('s1-date').value;

            if (!dateVal) {
                showError(errorEl, 'Please select a date.');
                resultEl.style.display = 'none';
                return;
            }

            const inputDate = buildDate(
                dateVal,
                document.getElementById('s1-hour'),
                document.getElementById('s1-min'),
                document.getElementById('s1-sec')
            );
            const now = new Date();
            const diffMs = now - inputDate;
            const diff = formatDiff(diffMs);
            const prefix = diffMs >= 0 ? '' : '-';

            hideError(errorEl);
            resultEl.style.display = 'block';
            document.getElementById('s1-input-display').textContent = formatDateTime(inputDate);
            document.getElementById('s1-now-display').textContent = formatDateTime(now);
            document.getElementById('s1-dhms').textContent = prefix + diff.dhms;
            document.getElementById('s1-hours').textContent = prefix + diff.totalHours + ' hours';
        });

        // Section 2: Difference between two times
        document.getElementById('s2-btn').addEventListener('click', function () {
            const errorEl = document.getElementById('s2-error');
            const resultEl = document.getElementById('s2-result');
            const date1Val = document.getElementById('s2-date1').value;
            const date2Val = document.getElementById('s2-date2').value;

            if (!date1Val || !date2Val) {
                showError(errorEl, 'Please select both start and end dates.');
                resultEl.style.display = 'none';
                return;
            }

            const startDate = buildDate(
                date1Val,
                document.getElementById('s2-hour1'),
                document.getElementById('s2-min1'),
                document.getElementById('s2-sec1')
            );
            const endDate = buildDate(
                date2Val,
                document.getElementById('s2-hour2'),
                document.getElementById('s2-min2'),
                document.getElementById('s2-sec2')
            );
            const diffMs = endDate - startDate;
            const diff = formatDiff(diffMs);
            const prefix = diffMs >= 0 ? '' : '-';

            hideError(errorEl);
            resultEl.style.display = 'block';
            document.getElementById('s2-start-display').textContent = formatDateTime(startDate);
            document.getElementById('s2-end-display').textContent = formatDateTime(endDate);
            document.getElementById('s2-dhms').textContent = prefix + diff.dhms;
            document.getElementById('s2-hours').textContent = prefix + diff.totalHours + ' hours';
        });
    </script>
</body>
</html>
